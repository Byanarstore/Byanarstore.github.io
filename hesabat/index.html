<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yük Təhvilatları - Sirab MMC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.5;
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 40;
            padding: 12px 16px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .header-info h1 {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 2px;
        }

        .header-info .user {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 1px;
        }

        .header-info .company {
            font-size: 12px;
            color: #6b7280;
        }

        .monthly-total {
            text-align: right;
        }

        .monthly-total .label {
            font-size: 12px;
            color: #6b7280;
        }

        .monthly-total .amount {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-card {
            border-radius: 8px;
            padding: 8px;
            text-align: center;
        }

        .stat-card.blue {
            background-color: #eff6ff;
        }

        .stat-card.green {
            background-color: #f0fdf4;
        }

        .stat-card.orange {
            background-color: #fff7ed;
        }

        .stat-card .label {
            font-size: 12px;
            color: #4b5563;
        }

        .stat-card .value {
            font-weight: 600;
            font-size: 14px;
        }

        .stat-card.blue .value {
            color: #2563eb;
        }

        .stat-card.green .value {
            color: #059669;
        }

        .stat-card.orange .value {
            color: #ea580c;
        }

        .main-content {
            flex: 1;
            padding: 16px;
            padding-bottom: 80px;
        }

        .delivery-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            padding: 16px;
            margin-bottom: 12px;
        }

        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .delivery-info {
            flex: 1;
        }

        .delivery-date {
            display: inline-block;
            font-size: 12px;
            background: #dbeafe;
            color: #1d4ed8;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
            margin-bottom: 4px;
            margin-right: 8px;
        }

        .delivery-id {
            font-size: 12px;
            color: #9ca3af;
        }

        .delivery-order {
            font-weight: 600;
            color: #111827;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .delivery-to {
            font-size: 12px;
            color: #4b5563;
            margin-bottom: 8px;
        }

        .edit-btn {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            color: #9ca3af;
        }

        .edit-btn:hover {
            background: #f9fafb;
        }

        .delivery-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-item.right {
            justify-content: flex-end;
        }

        .weight-icon, .money-icon {
            width: 16px;
            height: 16px;
        }

        .weight-icon {
            color: #3b82f6;
        }

        .money-icon {
            color: #10b981;
        }

        .weight-text {
            font-size: 14px;
            color: #4b5563;
        }

        .amount-text {
            font-weight: 600;
            font-size: 14px;
            color: #059669;
        }

        .empty-state {
            text-align: center;
            padding: 64px 16px;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 24px;
        }

        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: #3b82f6;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            z-index: 50;
        }

        .fab:hover {
            background: #2563eb;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .fab svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 16px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 448px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
        }

        .modal-header {
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 16px;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 8px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            padding-top: 16px;
        }

        .btn {
            flex: 1;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .btn-outline {
            background: white;
            border: 1px solid #d1d5db;
            color: #374151;
        }

        .btn-outline:hover {
            background: #f9fafb;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
            width: 100%;
            margin-top: 16px;
            border-top: 1px solid #e5e7eb;
            padding-top: 16px;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .delete-section {
            border-top: 1px solid #e5e7eb;
            padding-top: 16px;
            margin-top: 24px;
        }

        .loading {
            display: none;
        }

        .loading.show {
            display: block;
        }

        .skeleton {
            background: white;
            border-radius: 12px;
            height: 128px;
            margin-bottom: 12px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 640px) {
            .delivery-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .detail-item.right {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-info">
                    <h1>Yük Təhvilatları</h1>
                    <p class="user">Anar - Sürücü Köməkçisi</p>
                    <p class="company">Sirab MMC</p>
                </div>
                <div class="monthly-total">
                    <p class="label">Bu ay</p>
                    <p class="amount" id="monthlyTotal">0 ₼</p>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card blue">
                    <p class="label">Təhvilat</p>
                    <p class="value" id="monthlyDeliveries">0</p>
                </div>
                <div class="stat-card green">
                    <p class="label">Yük (Ton)</p>
                    <p class="value" id="monthlyWeight">0.0</p>
                </div>
                <div class="stat-card orange">
                    <p class="label">Ortalama</p>
                    <p class="value" id="averageAmount">0 ₼</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div id="loading" class="loading">
                <div class="skeleton"></div>
                <div class="skeleton"></div>
                <div class="skeleton"></div>
            </div>

            <div id="deliveryList" class="delivery-list"></div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="icon">🚛</div>
                <h3>Hələ təhvilat yoxdur</h3>
                <p>Yeni təhvilat əlavə etmək üçün aşağıdakı düyməni basın</p>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button class="fab" onclick="openModal()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
        </button>

        <!-- Modal -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalTitle">Yeni Təhvilat</h2>
                </div>

                <form id="deliveryForm">
                    <div class="form-group">
                        <label class="form-label">Tarix</label>
                        <input type="date" class="form-input" id="date" autocomplete="off" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Yük Çəkisi</label>
                             <input type="number" class="form-input" id="weight" step="0.1" min="0" placeholder="5.8" autocomplete="off" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vahid</label>
                            <select class="form-select" id="weightUnit" autocomplete="off" required>
                                <option value="Ton">Ton</option>
                                <option value="Kq">Kq</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sifariş sayı</label>
                        <input type="number" class="form-input" id="order" placeholder="30" autocomplete="off" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Təhvil Verilən</label>
                        <input type="number" class="form-input" id="deliveredTo" placeholder="22" autocomplete="off" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Təxmini Məbləğ (₼)</label>
                        <input type="number" class="form-input" id="amount" step="0.01" min="0" placeholder="180" autocomplete="off" required>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Ləğv et</button>
                        <button type="submit" class="btn btn-primary">Yadda saxla</button>
                    </div>
                </form>

                <div id="deleteSection" class="delete-section" style="display: none;">
                    <button type="button" class="btn btn-danger" onclick="deleteDelivery()">
                        🗑️ Sil
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let deliveries = [];
        let editingDelivery = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setDefaultDate();
            updateStats();
            renderDeliveries();
        });

        // Load data from localStorage
        function loadData() {
            const stored = localStorage.getItem('sirab_deliveries');
            if (stored) {
                deliveries = JSON.parse(stored);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('sirab_deliveries', JSON.stringify(deliveries));
        }

        // Set default date to today
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }

        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = [
                'yanvar', 'fevral', 'mart', 'aprel', 'may', 'iyun',
                'iyul', 'avqust', 'sentyabr', 'oktyabr', 'noyabr', 'dekabr'
            ];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        // Update header statistics
        function updateStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const currentMonthDeliveries = deliveries.filter(delivery => {
                const deliveryDate = new Date(delivery.date);
                return deliveryDate.getMonth() === currentMonth && deliveryDate.getFullYear() === currentYear;
            });

            const monthlyTotal = currentMonthDeliveries.reduce((sum, delivery) => {
                return sum + parseFloat(delivery.amount);
            }, 0);

            const monthlyWeight = currentMonthDeliveries.reduce((sum, delivery) => {
                const weight = parseFloat(delivery.weight);
                return sum + (delivery.weightUnit === "Kq" ? weight / 1000 : weight);
            }, 0);

            const averageAmount = currentMonthDeliveries.length > 0 
                ? monthlyTotal / currentMonthDeliveries.length 
                : 0;

            document.getElementById('monthlyTotal').textContent = `${monthlyTotal.toFixed(0)} ₼`;
            document.getElementById('monthlyDeliveries').textContent = currentMonthDeliveries.length;
            document.getElementById('monthlyWeight').textContent = monthlyWeight.toFixed(1);
            document.getElementById('averageAmount').textContent = `${averageAmount.toFixed(0)} ₼`;
        }

        // Render delivery list
        function renderDeliveries() {
            const deliveryList = document.getElementById('deliveryList');
            const emptyState = document.getElementById('emptyState');
            
            if (deliveries.length === 0) {
                deliveryList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            // First sort by creation date (oldest first) to assign sequential numbers
            const chronologicalDeliveries = [...deliveries].sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
            
            // Create a map of delivery ID to sequential number
            const deliveryNumbers = {};
            chronologicalDeliveries.forEach((delivery, index) => {
                deliveryNumbers[delivery.id] = index + 1;
            });
            
            // Then sort by creation date (newest first) for display
            const sortedDeliveries = [...deliveries].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            deliveryList.innerHTML = sortedDeliveries.map(delivery => `
                <div class="delivery-card">
                    <div class="delivery-header">
                        <div class="delivery-info">
                            <div>
                                <span class="delivery-date">${formatDate(delivery.date)}</span>
                                <span class="delivery-id">№${deliveryNumbers[delivery.id]}</span>
                            </div>
                            <p class="delivery-order">Sifariş: ${delivery.order}</p>
                            <p class="delivery-to">Təhvil verilən: ${delivery.deliveredTo}</p>
                        </div>
                        <button class="edit-btn" onclick="editDelivery('${delivery.id}')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="delivery-details">
                        <div class="detail-item">
                            <svg class="weight-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path>
                            </svg>
                            <span class="weight-text">${delivery.weight} ${delivery.weightUnit}</span>
                        </div>
                        <div class="detail-item right">
                            <svg class="money-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            <span class="amount-text">${parseFloat(delivery.amount).toFixed(0)} ₼</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open modal for new delivery
        function openModal() {
            editingDelivery = null;
            document.getElementById('modalTitle').textContent = 'Yeni Təhvilat';
            document.getElementById('deleteSection').style.display = 'none';
            document.getElementById('deliveryForm').reset();
            setDefaultDate();
            document.getElementById('modal').classList.add('show');
        }

        // Edit existing delivery
        function editDelivery(id) {
            editingDelivery = deliveries.find(d => d.id === id);
            if (!editingDelivery) return;

            document.getElementById('modalTitle').textContent = 'Təhvilatı Redaktə Et';
            document.getElementById('deleteSection').style.display = 'block';
            
            // Fill form with existing data
            document.getElementById('date').value = editingDelivery.date;
            document.getElementById('weight').value = editingDelivery.weight;
            document.getElementById('weightUnit').value = editingDelivery.weightUnit;
            document.getElementById('order').value = editingDelivery.order;
            document.getElementById('deliveredTo').value = editingDelivery.deliveredTo;
            document.getElementById('amount').value = editingDelivery.amount;
            
            document.getElementById('modal').classList.add('show');
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal').classList.remove('show');
            editingDelivery = null;
            document.getElementById('deliveryForm').reset();
        }

        // Delete delivery
        function deleteDelivery() {
            if (!editingDelivery) return;
            
            if (confirm('Bu təhvilatı silmək istədiyinizdən əminsiniz?')) {
                deliveries = deliveries.filter(d => d.id !== editingDelivery.id);
                saveData();
                updateStats();
                renderDeliveries();
                closeModal();
            }
        }

        // Handle form submission
        document.getElementById('deliveryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                date: document.getElementById('date').value,
                weight: document.getElementById('weight').value,
                weightUnit: document.getElementById('weightUnit').value,
                order: document.getElementById('order').value,
                deliveredTo: document.getElementById('deliveredTo').value,
                amount: document.getElementById('amount').value,
            };

            if (editingDelivery) {
                // Update existing delivery
                const index = deliveries.findIndex(d => d.id === editingDelivery.id);
                if (index !== -1) {
                    deliveries[index] = { ...deliveries[index], ...formData };
                }
            } else {
                // Create new delivery
                const newDelivery = {
                    ...formData,
                    id: generateId(),
                    createdAt: new Date().toISOString(),
                };
                deliveries.unshift(newDelivery);
            }

            saveData();
            updateStats();
            renderDeliveries();
            closeModal();
        });

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Handle escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
